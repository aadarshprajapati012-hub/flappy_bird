<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Bird Fixed</title>
  <style>
    html,body{height:100%;margin:0;background:#000;font-family:Inter,system-ui;}
    #gameWrap{display:flex;align-items:center;justify-content:center;height:100%;position:relative}
    canvas{border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.4)}
    .overlay{position:absolute;top:12px;left:12px;background:rgba(255,255,255,0.75);padding:8px 12px;border-radius:8px;font-weight:700}
    .centerText{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;color:white}
    #mobileBtns{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);display:none}
    #mobileBtns button{padding:22px;border-radius:50%;font-size:24px;background:#1a8cff;color:white;border:none;}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game" width="400" height="600"></canvas>
    <div class="overlay" id="scoreBox">Score: 0</div>
    <div class="centerText" id="centerUI"><button id="startBtn">Start Game</button></div>
    <div id="mobileBtns"><button id="jumpBtn">⬆</button></div>
  </div>

<script>
// IMAGES
const bgImg = new Image(); bgImg.src = "https://i.ibb.co/LdM8P7zR/download-1.jpg";
const pipeTop1 = new Image(); pipeTop1.src = "https://i.ibb.co/GfBK81rp/Screenshot-2025-12-07-at-9-46-13-PM.png";
const pipeTop2 = new Image(); pipeTop2.src = "https://i.ibb.co/XfSG63rj/Screenshot-2025-12-07-at-9-46-05-PM.png";
const pipeBottom1 = new Image(); pipeBottom1.src = "https://i.ibb.co/W4WRGbp3/Screenshot-2025-12-07-at-9-48-18-PM.png";
const pipeBottom2 = new Image(); pipeBottom2.src = "https://i.ibb.co/8nSZm9yg/Screenshot-2025-12-07-at-9-48-09-PM.png";

const birdImg = new Image(); birdImg.src = "https://i.ibb.co/3y35STBv/Whats-App-Image-2025-12-07-at-9-20-28-PM.jpg";

// SOUND
const flapSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-player-jumping-in-a-video-game-2043.mp3");
const hitSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-explosion-2759.mp3");

// GAME VARIABLES
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreBox = document.getElementById("scoreBox");
const centerUI = document.getElementById("centerUI");
const mobileBtns = document.getElementById("mobileBtns");
const jumpBtn = document.getElementById("jumpBtn");

let frame = 0;
let gravity = 0.45;
let flapStrength = -8;
let Speed = 3;

let bird, pipes, score, bestScore = 0;
let gameOver = false;

function resetGame() {
  bird = { x:80, y:300, vy:0, angle:0, r:18 };
  pipes = [];
  score = 0;
  frame = 0;
  gameOver = false;
  scoreBox.textContent = "Score: 0";
  // ensure mobile buttons are hidden until start
  mobileBtns.style.display = "none";
}

function spawnPipe() {
  const gap = 150;
  const topY = Math.random()*250 + 50;

  pipes.push({
    x: 420,
    w: 70,
    top: topY,
    bottom: topY + gap,
    topImg: Math.random()>0.5 ? pipeTop1 : pipeTop2,
    bottomImg: Math.random()>0.5 ? pipeBottom1 : pipeBottom2,
    passed: false
  });
}

function update() {
  frame++;

  bird.vy += gravity;
  bird.y += bird.vy;
  bird.angle = Math.min(1, bird.vy/10);

  pipes.forEach(p => {
    p.x -= Speed;

    if(!p.passed && p.x + p.w < bird.x) {
      p.passed = true;
      score++;
      scoreBox.textContent = "Score: " + score;
    }
  });

  pipes = pipes.filter(p => p.x + p.w > -50);

  if(frame % 110 === 0) spawnPipe();

  // collide
  if(bird.y + bird.r >= 600) endGame();
  if(bird.y - bird.r <= 0) {
    bird.y = bird.r;
    bird.vy = 0;
  }

  for(const p of pipes){
    const hitX = bird.x + bird.r > p.x && bird.x - bird.r < p.x+p.w;
    const hitTop = hitX && bird.y - bird.r < p.top;
    const hitBottom = hitX && bird.y + bird.r > p.bottom;
    if(hitTop || hitBottom) endGame();
  }
}

function endGame(){
  if(gameOver) return;
  gameOver = true;
  // try-catch audio in case browser blocks autoplay; won't break the game
  try { hitSound.play(); } catch(e){ /* audio blocked until user interaction */ }
  centerUI.style.display = "block";
  centerUI.innerHTML = `
    <h2>Game Over</h2>
    <p>Score: ${score}</p>
    <button id="restartBtn">Restart</button>
  `;
  // attach restart handler to new button
  document.getElementById("restartBtn").onclick = startGame;
}

function draw(){
  // draw background (image may not be loaded yet — that's ok)
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(bgImg,0,0,400,600);

  pipes.forEach(p=>{
    // draw top pipe (positioned above), and bottom pipe
    ctx.drawImage(p.topImg, p.x, p.top - 350, p.w, 350);
    ctx.drawImage(p.bottomImg, p.x, p.bottom, p.w, 350);
  });

  if(bird){
    ctx.save();
    ctx.translate(bird.x,bird.y);
    ctx.rotate(bird.angle);
    ctx.drawImage(birdImg,-20,-20,40,40);
    ctx.restore();
  }
}

function loop(){
  // safety: if bird is not yet initialized, skip update but continue loop
  if(!bird){
    draw(); // allow background to render if images available
    requestAnimationFrame(loop);
    return;
  }

  if(!gameOver) update();
  draw();
  requestAnimationFrame(loop);
}

function flap(){
  if(!gameOver){
    bird.vy = flapStrength;
    try { flapSound.play(); } catch(e){ /* sound may be blocked until first user gesture */ }
  }
}

function startGame(){
  centerUI.style.display="none";
  mobileBtns.style.display="flex";
  resetGame();
}

// INPUT
window.onkeydown = e=>{ if(e.code==="Space") flap(); };
canvas.onmousedown = flap;
canvas.ontouchstart = e=>{ e.preventDefault(); flap(); };
jumpBtn.onclick = flap;

document.getElementById("startBtn").onclick = startGame;

// IMPORTANT: initialize game state before starting loop to avoid undefined errors
resetGame();
loop();
</script>
</body>
</html>

